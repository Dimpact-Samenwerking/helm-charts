{{- if or (index .Values "keycloak-operator").enabled .Values.keycloak.enabled }}
# Database credentials secret for Keycloak.
# Referenced by the Keycloak CR (keycloak-operator) and the legacy Bitnami chart.
# Note: Uses .Values.keycloak.externalDatabase.user (not .username) to maintain
# compatibility with the legacy Bitnami Keycloak chart structure.
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.keycloak.secretsName }}
  labels:
    {{- include "podiumd.labels" . | nindent 4 }}
    app.kubernetes.io/component: keycloak
type: Opaque
stringData:
  database_username: {{ .Values.keycloak.externalDatabase.user | quote }}
  database_password: {{ .Values.keycloak.externalDatabase.password | quote }}
{{- end }}
{{- if (index .Values "keycloak-operator").enabled }}
---
# Bootstrap admin credentials for Keycloak operator.
#
# Uses a custom name (keycloak-podiumd-admin) instead of the operator's default
# (<cr-name>-initial-admin) to avoid conflicts. The operator will auto-generate
# its default secret, but we override it by explicitly setting bootstrapAdmin.user.secret
# in the Keycloak CR.
#
# NOTE: For existing installations (migrated DB), Keycloak ignores this secret
# because an admin user already exists. It is only consumed on first boot with
# an empty database. Use keycloak.auth.adminUser / keycloak.auth.adminPassword
# to configure the desired bootstrap credentials.
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-podiumd-admin
  labels:
    {{- include "podiumd.labels" . | nindent 4 }}
    app.kubernetes.io/component: keycloak
type: Opaque
stringData:
  username: {{ .Values.keycloak.auth.adminUser | quote }}
  password: {{ .Values.keycloak.auth.adminPassword | quote }}
{{- end }}
